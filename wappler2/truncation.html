<!doctype html>
<html><head>
<meta charset="UTF-8">
<title>Truncation</title>
  <script src="dmxAppConnect/dmxAppConnect.js"></script>
  <script src="js/jquery-3.3.1.slim.min.js"></script>
  <script type="text/javascript" src="https://static.sketchfab.com/api/sketchfab-viewer-1.5.1.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="style.sass">
<link rel="stylesheet" href="css/jquery.xslider.css">
<link href="css/jquery.slider.css" rel="stylesheet">
  <script src="js/jquery.xslider.js"></script>
  <script src="js/jquery.slider.js"></script>
  </head>
  <body is="dmx-app" id="index">
    <div class="container wappler-block">
      <div class="row">
        <div class="col-12 col-xl col-lg col-md-12 col-sm-12">
          <div class="ratio-square">
            <!-- Insert an empty iframe -->
            <iframe class="ratio-inner" src="" id="api-frame" allow="autoplay; fullscreen; vr" allowvr="" allowfullscreen="" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>
          </div>
        </div>
        <div class="col-12 align-self-xl-end align-self-md-start align-self-lg-end col-xl-2 col-lg-3 col-md-12 col-sm-12">
          <div><h1>Truncation</h1>
          <p>This is a test of the rotating earth visualisation made with Sketchfab. The texture of the earth should change when you press the buttons below! Let's try it!</p>
            <input id="trcSlider">

          </div>
          <div>
</div>
          <div>
          </div>
        </div>
      </div>
    </div>
    <!-- Initialize the viewer -->
    <script type="text/javascript">
      function idx2trc(idx) {
        var trc = 0;
        if (idx == 0) {
          trc = 0;
        } else if (idx < 8) {
          trc = Math.pow(2,(idx-1));
        } else if (idx == 8) {
          trc = 159;
        } else if (idx == 9) {
          trc = 399;
        } else if (idx == 10) {
          trc = 639;
        } else if (idx == 11) {
          trc = 1279;
        }
        return trc;
      }
      var oldval = 0;
      // Sketchfab Viewer API: Change Texture/material
      var uid = '928a81dbfcbc4944a5ecac27f820c6ca';//'fb43aced2ee14e1db1f4acb7638d352e';
      var iframe = document.getElementById('api-frame');
      var client = new window.Sketchfab(iframe);
      var myMaterials;
      var error = function() {
        console.error('Sketchfab API error');
      };
      var success = function(api) {
        api.start(function() {
          api.addEventListener('viewerready', function() {
            api.getMaterialList(function(err, materials) {
              myMaterials = materials;
              console.log(myMaterials);
            });
            api.getTextureList(function(err, textures) {
              console.log(textures);
            });

            function loadTexture(file) {
                //var url = 'https://anmrde.github.io/spectral/t399.png';
                   //'https://upload.wikimedia.org/wikipedia/commons/8/83/Equirectangular_projection_SW.jpg'; 
              //'https://media.sketchfab.com/urls/7w7pAfrCfjovwykkEeRFLGw5SXS/dist/textures/24ae87ff02fe47e296d09175f86dc16a/0172db054ca945b0a95b35f9e6364a77.png';
				var url = 'https://anmrde.github.io/spectral/orography/greenAt60m/';
                for (var i = 0; i < myMaterials.length; i++) {
                    var m = myMaterials[i];
                  	if(m.name == 'earth') {
                        api.updateTexture(url+file, m.channels.DiffusePBR.texture.uid, function(/*e, uid*/) {});
                        api.updateTexture(url+'ocean'+file, m.channels.SpecularPBR.texture.uid, function(/*e, uid*/) {});
                      	api.setMaterial(m);
                    }
                }
            }

      var trcSlider = $("#trcSlider").slider({min: 0, max: 11, step: 1, value: 0, prefix:'T', thumbScale: 0.5, bubbleFontScale: 0.7, thumbColor: '#6ccccc', bubbleFormat: function(val){ return idx2trc(val);}, onChange: function(val){if(trcSlider.value != oldval) {loadTexture('T'+idx2trc(trcSlider.value)+'.png'); oldval = trcSlider.value;}}, onChangeEnd: function(val){loadTexture('T'+idx2trc(trcSlider.value)+'.png');}});
        });
    });
};
client.init(uid, {
    success: success,
    error: error,
    autostart: 1,
    preload: 1
});

    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </body></html>
