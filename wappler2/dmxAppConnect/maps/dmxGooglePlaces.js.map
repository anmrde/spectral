{"version":3,"sources":["components/googleAutocomplete.js","components/googlePlacesSearch.js"],"names":["dmx","Component","extends","initialData","placeId","address","phone","phone2","latitude","longitude","icon","name","priceLevel","rating","types","url","utcOffset","vicinity","website","attributes","map","type","String","default","country","strict-bounds","Boolean","move-map","render","node","BaseComponent","prototype","call","this","$node","value","props","disabled","defaultValue","set","target","document","getElementById","dmxComponent","autocomplete","google","maps","places","Autocomplete","strictBounds","split","bindTo","setComponentRestrictions","addListener","onchange","bind","update","setOptions","place","getPlace","place_id","formatted_address","formatted_phone_number","international_phone_number","geometry","location","lat","lng","price_level","utc_offset","viewport","fitBounds","setCenter","setZoom","setTimeout","dispatchEvent","results","hasMore","status","Number","radius","bind-bounds","keyword","open-now","show-on-map","methods","nearby","request","markers","forEach","marker","setMap","bounds","getBounds","getCenter","openNow","service","PlacesService","nearbySearch","onresults","search","query","textSearch","getMore","pagination","hasNextPage","nextPage","opening_hours","open_now","image","size","Size","origin","Point","anchor","scaledSize","Marker","title","position","push","console","warn"],"mappings":"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","file":"../dmxGooglePlaces/dmxGooglePlaces.js","sourcesContent":["dmx.Component('google-autocomplete', {\r\n\r\n    extends: 'input',\r\n\r\n    initialData:{\r\n        placeId: null,\r\n        address: null,\r\n        phone: null,\r\n        phone2: null,\r\n        latitude: null,\r\n        longitude: null,\r\n        icon: null,\r\n        name: null,\r\n        priceLevel: null,\r\n        rating: null,\r\n        types: null,\r\n        url: null,\r\n        utcOffset: null, // in minutes\r\n        vicinity: null,\r\n        website: null\r\n    },\r\n\r\n    attributes: {\r\n        map: {\r\n            type: String,\r\n            default: null\r\n        },\r\n\r\n        country: { // restrict to country (ISO 3166-1 Alpha-2 country code) (up to 5 max, separate with comma)\r\n            type: String,\r\n            default: null\r\n        },\r\n\r\n        types: {\r\n            type: String,\r\n            default: null // geocode, address, establishment, (regions), (cities)\r\n        },\r\n\r\n        'strict-bounds': {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n\r\n        'move-map': {\r\n            type: Boolean,\r\n            default: false\r\n        }\r\n    },\r\n\r\n    render: function(node) {\r\n        dmx.BaseComponent.prototype.render.call(this, node);\r\n        this.$node.value = this.props.value;\r\n        this.$node.disabled = this.props.disabled;\r\n        this.$node.defaultValue = this.props.value;\r\n        this.set('value', this.props.value);\r\n        this.set('disabled', this.props.disabled);\r\n\r\n        this.target = document.getElementById(this.props.map);\r\n        this.map = this.target && this.target.dmxComponent && this.target.dmxComponent.map;\r\n\r\n        this.autocomplete = new google.maps.places.Autocomplete(this.$node, {\r\n            strictBounds: this.props['strict-bounds'],\r\n            types: this.props.types ? this.props.types.split(/\\s*,\\s*/) : [],\r\n        });\r\n\r\n        if (this.map) {\r\n            this.autocomplete.bindTo('bounds', this.map);\r\n        }\r\n\r\n        if (this.props.country) {\r\n            this.autocomplete.setComponentRestrictions({country: this.props.country.split(/\\s*,\\s*/)});\r\n        }\r\n\r\n        this.autocomplete.addListener('place_changed', this.onchange.bind(this));\r\n    },\r\n\r\n    update: function(props) {\r\n        if (this.props.map && !this.map) {\r\n            this.map = this.target && this.target.dmxComponent && this.target.dmxComponent.map;\r\n            this.autocomplete.bindTo('bounds', this.map);\r\n        }\r\n\r\n        if (props['strict-bounds'] != this.props['strict-bounds']) {\r\n            this.autocomplete.setOptions({ strictBounds: this.props['strict-bounds'] });\r\n        }\r\n\r\n        if (props.types != this.props.types) {\r\n            this.autocomplete.setOptions({ types: this.props.types });\r\n        }\r\n\r\n        if (props.country != this.props.country) {\r\n            this.autocomplete.setComponentRestrictions({country: this.props.country ? this.props.country.split(/\\s*,\\s*/) : []});\r\n        }\r\n\r\n        if (props.disabled != this.props.disabled) {\r\n            this.$node.disabled = this.props.disabled;\r\n        }\r\n    },\r\n\r\n    onchange: function() {\r\n        var place = this.autocomplete.getPlace();\r\n        if (!place.place_id) return;\r\n\r\n        this.set('value', this.$node.value);\r\n        this.set({\r\n            placeId: place.place_id,\r\n            address: place.formatted_address,\r\n            phone: place.formatted_phone_number,\r\n            phone2: place.international_phone_number,\r\n            latitude: place.geometry.location.lat(),\r\n            longitude: place.geometry.location.lng(),\r\n            icon: place.icon,\r\n            name: place.name,\r\n            priceLevel: place.price_level,\r\n            rating: place.rating,\r\n            types: place.types,\r\n            url: place.url,\r\n            utcOffset: place.utc_offset,\r\n            vicinity: place.vicinity,\r\n            website: place.website\r\n        });\r\n\r\n        if (this.props['move-map'] && this.map) {\r\n            if (place.geometry.viewport) {\r\n                this.map.fitBounds(place.geometry.viewport);\r\n            } else {\r\n                this.map.setCenter(place.geometry.location);\r\n                this.map.setZoom(17);\r\n            }\r\n        }\r\n\r\n        setTimeout(this.dispatchEvent.bind(this, 'updated'), 100);\r\n    }\r\n\r\n});\r\n","dmx.Component('google-places-search', {\r\n\r\n    initialData:{\r\n        results: [],\r\n        hasMore: false,\r\n        status: ''\r\n    },\r\n\r\n    attributes: {\r\n        map: {\r\n            type: String,\r\n            default: null\r\n        },\r\n\r\n        latitude: {\r\n            type: Number,\r\n            default: null\r\n        },\r\n\r\n        longitude: {\r\n            type: Number,\r\n            default: null\r\n        },\r\n\r\n        radius: { // in meters\r\n            type: Number,\r\n            default: null\r\n        },\r\n\r\n        'bind-bounds': { // search inside map boundaries, ignores lat/lng/radius\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n\r\n        keyword: { // A term to be matched against all available fields\r\n            type: String,\r\n            default: null\r\n        },\r\n\r\n        'open-now': { // Restricts results to only those places that are open right now.\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n\r\n        type: { // supported types see: https://developers.google.com/places/supported_types?authuser=0\r\n            type: String,\r\n            default: null\r\n        },\r\n\r\n        'show-on-map': {\r\n            type: Boolean,\r\n            default: false\r\n        }\r\n    },\r\n\r\n    methods: {\r\n        nearby: function(name) { // name is optional\r\n            var request = {};\r\n\r\n            this.markers.forEach(function(marker) {\r\n                // remove from map\r\n                marker.setMap(null);\r\n            });\r\n\r\n            this.markers = [];\r\n\r\n            if (this.props['bind-bounds']) {\r\n                request.bounds = this.map.getBounds();\r\n            } else if (this.props.latitude != null && this.props.longitude != null) {\r\n                request.location = { lat: this.props.latitude, lng: this.props.longitude };\r\n\r\n                if (this.props.radius) {\r\n                    request.radius = this.props.radius;\r\n                }\r\n            } else if (this.props.radius) {\r\n                request.location = this.map.getCenter();\r\n                request.radius = this.props.radius;\r\n            }\r\n\r\n            request.openNow = this.props['open-now'];\r\n\r\n            if (this.props.type) {\r\n                request.type = this.props.type;\r\n            }\r\n\r\n            if (name) {\r\n                request.name = name;\r\n            }\r\n\r\n            var service = new google.maps.places.PlacesService(this.map);\r\n            service.nearbySearch(request, this.onresults.bind(this));\r\n        },\r\n\r\n        search: function(query) {\r\n            var request = { query: query };\r\n\r\n            this.markers.forEach(function(marker) {\r\n                // remove from map\r\n                marker.setMap(null);\r\n            });\r\n\r\n            this.markers = [];\r\n\r\n            if (this.props['bind-bounds']) {\r\n                request.bounds = this.map.getBounds();\r\n            } else if (this.props.latitude != null && this.props.longitude != null) {\r\n                request.location = { lat: this.props.latitude, lng: this.props.longitude };\r\n\r\n                if (this.props.radius) {\r\n                    request.radius = this.props.radius;\r\n                }\r\n            } else if (this.props.radius) {\r\n                request.location = this.map.getCenter();\r\n                request.radius = this.props.radius;\r\n            }\r\n\r\n            request.openNow = this.props['open-now'];\r\n\r\n            if (this.props.type) {\r\n                request.type = this.props.type;\r\n            }\r\n\r\n            var service = new google.maps.places.PlacesService(this.map);\r\n            service.textSearch(request, this.onresults.bind(this));\r\n        },\r\n\r\n        getMore: function() {\r\n            if (this.pagination && this.pagination.hasNextPage) {\r\n                this.pagination.nextPage();\r\n            }\r\n        }\r\n    },\r\n\r\n    render: function(node) {\r\n        this.markers = [];\r\n        this.target = document.getElementById(this.props.map);\r\n        this.map = this.target && this.target.dmxComponent && this.target.dmxComponent.map;\r\n    },\r\n\r\n    update: function(props) {\r\n        if (this.props.map && !this.map) {\r\n            this.map = this.target && this.target.dmxComponent && this.target.dmxComponent.map;\r\n        }\r\n    },\r\n\r\n    onresults: function(results, status, pagination) {\r\n        this.set('status', status);\r\n        this.set('hasMore', !!(pagination && pagination.hasNextPage));\r\n\r\n        this.pagination = pagination;\r\n\r\n        if (status == 'OK') {\r\n            this.set('results', results.map(function(place) {\r\n                return {\r\n                    placeId: place.place_id,\r\n                    address: place.formatted_address,\r\n                    latitude: place.geometry.location.lat(),\r\n                    longitude: place.geometry.location.lng(),\r\n                    icon: place.icon,\r\n                    name: place.name,\r\n                    priceLevel: place.price_level,\r\n                    rating: place.rating,\r\n                    types: place.types,\r\n                    vicinity: place.vicinity,\r\n                    openNow: place.opening_hours && place.opening_hours.open_now\r\n                }\r\n            }));\r\n\r\n            if (this.props['show-on-map']) {\r\n                // create markers on map\r\n                results.forEach(function(place) {\r\n                    var image = {\r\n                        url: place.icon,\r\n                        size: new google.maps.Size(71, 71),\r\n                        origin: new google.maps.Point(0, 0),\r\n                        anchor: new google.maps.Point(17, 34),\r\n                        scaledSize: new google.maps.Size(25, 25)\r\n                    };\r\n\r\n                    var marker = new google.maps.Marker({\r\n                        map: this.map,\r\n                        icon: image,\r\n                        title: place.name,\r\n                        position: place.geometry.location\r\n                    });\r\n\r\n                    this.markers.push(marker);\r\n                }, this);\r\n            }\r\n        } else {\r\n            console.warn('nearbySearch failed.', status);\r\n        }\r\n    }\r\n\r\n});\r\n"]}